<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->


<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<title>Welcome</title>
	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.3.0/pure-min.css"/>
	<link rel="stylesheet" href="css/main.css"/>
  </head>

  <body>
    <h1>Inter Clinic Evaluation</h1>
    
	<form id="join_form" action="signin.do" method="get" class="pure-form pure-form-stacked">
		<fieldset>
		<legend id="join_div">Sign in or create:</legend> 
		
		<label for="clinic_list">Clinic: </label>
		<select id="clinic_list" name="clinic_list" onchange="newClinicChosen()">
			<option>Choose a Clinic...</option>
		</select>
		<div id="clinician_options" style="display:none">
		<select id="peer_list" name="peer_list" onchange="clientChosen">
			<option value="invalid">Choose the user to sing in as...</option>
		</select>
		</div>
		</fieldset>
	</form>       
  
  <div id="infotext"></div>
  
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script>
  $(document).ready(function() {
	  $.ajax('/webrtceval.do', {
		method:'GET',
		dataType:'text',
		data: {
			type:"ClinicsList"
		},
		success:function(response) {
			$("#infotext").append("<div>Response from ClinicsList Request: </div>");
			$("#infotext").append("<div>"+response+"</div>");
			var arr = $.parseJSON(response);
			arr.map( function(item){
				$("#clinic_list").append('<option value=' + item + '>' + item + '</option>');
			});
		}
	}); 
  });
  
  function newClinicChosen(){
	  var clinicN = $('#clinic_list').val() + " Clinic";
	  if(clinicN.indexOf("Choose") != -1){
		  $("#clinician_options").slideUp(1000);
		  $('#peer_list option').each(function() {
			    if ( $(this).val() != 'invalid' ) {
			        $(this).remove();
			    }
			});
		  return;
	  } else {
	  $("#infotext").append("<div>"+clinicN+"</div>");
		$.ajax('/webrtceval.do', {
			method:'GET',
			dataType:'text',
			data: {
				type:"ClientsFromClinic",
				clinic:clinicN
			},
			success:function(response) {
				$("#infotext").append("<div>Response from ClientsFromClinic Request: </div>");
				$("#infotext").append("<div>"+response+"</div>");
				$('#clinician_options').slideDown(1000);
				if(response != "") {
					var arr = $.parseJSON(response);
					arr.map( function(item){
						$("#peer_list").append('<option value=' + item + '>' + item + '</option>');
					});
				}
				$("#peer_list").append('<option value="new">New User</option>');
			}
		}); 
	  }
  }
  
  function Create() {
	  $('#id').val("Create");
	  $('#join_form').submit();
  }
  
  function SignIn() {
	  $('#id').val("SignIn");
	  $('#join_form').submit();
  }
  </script>
  </body>
</html>
