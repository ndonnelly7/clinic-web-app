/**
 * 
 */

$(document).ready(function(){
	//check for depression and age
	setTimeout(addFormIfNeeded, 100);
});

function runHADSEvaluation(){
	var result = 0;
	var pass = true;
	$(".hads_select").each(function() {
		var v = $(this).val();
		if(v == 'na'){
			pass = false;
			$(this).css({"border": '#FF0000 1px solid'});
		} else {
			result += parseInt(v);
			$(this).css({"border": '#129FC0 1px solid'});
		}
	});
	
	if(!pass){
		alert("Please complete all entries for the HADS quoestionnaire");
	} else {
		$("#result_hads_div").show(500);
		$('#hads_result').val(result);
		if(result >= 21) {
			$('#hads_result_text').text("Severe case of depression/anxiety");
			$('#hads_result_text').css({"color":"red", "margin-left":"1%"});
		} else if(result >= 16) {
			$('#hads_result_text').text("Moderate case of depression/anxiety");
			$('#hads_result_text').css({"color":"orange", "margin-left":"1%"});
		} else if(result >= 11) {
			$('#hads_result_text').text("Mild case of depression/anxiety");
			$('#hads_result_text').css({"color":"yellow", "margin-left":"1%"});
		} else {
			$('#hads_result_text').text("No real signs of depression/anxiety");
			$('#hads_result_text').css({"color":"green", "margin-left":"1%"});
		}
	}
}

function runGDSEvaluation(){
	var result = 0;
	var pass = true;
	$(".gds_select").each(function() {
		var v = $(this).val();
		if(v == 'na'){
			pass = false;
			$(this).css({"border": '#FF0000 1px solid'});
		} else {
			result += parseInt(v);
			$(this).css({"border": '#129FC0 1px solid'});
		}
	});
	
	if(!pass){
		alert("Please complete all entries for the GDS quoestionnaire");
	} else {
		$("#result_gds_div").show(500);
		$('#gds_result').val(result);
		if(result >= 6) {
			$('#gds_result_text').text("Suggestion of depression");
			$('#gds_result_text').css({"color":"red", "margin-left":"1%"});
		} else {
			$('#gds_result_text').text("No real signs of depression");
			$('#gds_result_text').css({"color":"green", "margin-left":"1%"});
		}
	}
}

function updateBorder(elem){
	
	if($(elem).css("border-color") == "rgb(255, 0, 0)" && $(elem).val() != "na"){
		$(elem).css({"border": ''});
	} else if($(elem).val() == "na"){
		$(elem).css({"border": '#FF0000 1px solid'});
	}
}

function changeMOCAForm(x){
	if(x == 'general'){
		$("#moca_general").hide();
		$("#moca_blind").show();
	} else if(x == 'blind'){
		$("#moca_general").show();
		$("#moca_blind").hide();
	}
}

function addFormIfNeeded(){
	console.log("Entered function");
	var p_id = -1;
	if(typeof(Storage) !== "undefined"){
		p_id = sessionStorage.p_id;
	}
	console.log("set function");
	getPatientForm(p_id,function(pF){
		var depression = pF['events_activities']['depression'];
		if(depression){
			getPatient(p_id, function(p) {
				var year = p['dob'].split('/')[2];
				var thisYear = new Date().getFullYear();
				if((thisYear - year) > 65){
					$("#gds_form").show();
				} else {
					$("#hads_form").show();
				}
			});
		}
	});
}

function revealMMSE(elem){
	if($("#mmse").is(":visible")){
		$("#mmse").hide(500);
		elem.value = "MMSE Test";
	} else {
		$("#mmse").show(500);
		elem.value = "Hide MMSE Test";
	}
};

function revealMOCA(elem){
	if($("#moca").is(":visible")){
		$("#moca").hide(500);
	} else {
		$("#moca").show(500);
	}
}